<!DOCTYPE html><!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]--><!--[if gt IE 8]><!--><html class=no-js lang=en> <head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width, initial-scale=1.0"><meta name=author content=SerDigital64><link href=https://aplatform64.readthedocs.io/roles/auto_ansible_control/ rel=canonical><link rel="shortcut icon" href=../../img/favicon.ico><title>auto_ansible_control - A:Platform64 Project</title><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700"><link rel=stylesheet href=../../css/theme.css><link rel=stylesheet href=../../css/theme_extra.css><link href=../../css/pygments-tango.css rel=stylesheet><script>
    // Current page data
    var mkdocs_page_name = "auto_ansible_control";
    var mkdocs_page_input_path = "roles/auto_ansible_control.md";
    var mkdocs_page_url = "/roles/auto_ansible_control/";
  </script><script src=../../js/jquery-2.1.1.min.js defer></script><script src=../../js/modernizr-2.8.3.min.js defer></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-KMX4RGXREV"></script><script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-KMX4RGXREV');
  </script></head> <body class=wy-body-for-nav role=document> <div class=wy-grid-for-nav> <nav data-toggle=wy-nav-shift class="wy-nav-side stickynav"> <div class=wy-side-scroll> <div class=wy-side-nav-search> <a href=../.. class="icon icon-home"> A:Platform64 Project</a> <div role=search> <form id=rtd-search-form class=wy-form action=../../search.html method=get> <input type=text name=q placeholder="Search docs" title="Type search term here"> </form> </div> </div> <div class="wy-menu wy-menu-vertical" data-spy=affix role=navigation aria-label="main navigation"> <ul> <li class=toctree-l1><a class="reference internal" href=../..>Home</a> </li> </ul> <p class=caption><span class=caption-text>Scripts</span></p> <ul> <li class=toctree-l1><a href=../../bin/ap64/ class="reference internal">ap64</a> </li> <li class=toctree-l1><a href=../../bin/install-aplatform64/ class="reference internal">install-aplatform64</a> </li> </ul> <p class=caption><span class=caption-text>Contributing</span></p> <ul> <li class=toctree-l1><a href=../../contributing/CONTRIBUTING/ class="reference internal">guidelines</a> </li> <li class=toctree-l1><a href=../../contributing/CODE_OF_CONDUCT/ class="reference internal">conduct</a> </li> <li class=toctree-l1><a class="reference internal" href=../../contributing/COPYING>license</a> </li> <li class=toctree-l1><a href=../../contributing/CHANGELOG/ class="reference internal">changelog</a> </li> </ul> <p class=caption><span class=caption-text>Playbooks</span></p> <ul> <li class=toctree-l1><a class href=../../playbooks/bootstrap_aplatform64_nodes.md>bootstrap_aplatform64_nodes</a> </li> <li class=toctree-l1><a href=../../playbooks/manage_aplatform64_servers/ class="reference internal">manage_aplatform64_servers</a> </li> <li class=toctree-l1><a href=../../playbooks/manage_aplatform64_nodes/ class="reference internal">manage_aplatform64_nodes</a> </li> <li class=toctree-l1><a href=../../playbooks/manage_cloud_control_nodes/ class="reference internal">manage_cloud_control_nodes</a> </li> <li class=toctree-l1><a href=../../playbooks/manage_cloud_realm/ class="reference internal">manage_cloud_realm</a> </li> <li class=toctree-l1><a href=../../playbooks/manage_dev_nodes/ class="reference internal">manage_dev_nodes</a> </li> <li class=toctree-l1><a href=../../playbooks/manage_doc_sites/ class="reference internal">manage_doc_sites</a> </li> <li class=toctree-l1><a href=../../playbooks/manage_file_servers/ class="reference internal">manage_file_servers</a> </li> <li class=toctree-l1><a href=../../playbooks/manage_git_servers/ class="reference internal">manage_git_servers</a> </li> <li class=toctree-l1><a href=../../playbooks/manage_gitlab_servers/ class="reference internal">manage_gitlab_servers</a> </li> <li class=toctree-l1><a href=../../playbooks/manage_hpc_nodes/ class="reference internal">manage_hpc_nodes</a> </li> <li class=toctree-l1><a href=../../playbooks/manage_jenkins_controllers/ class="reference internal">manage_jenkins_controllers</a> </li> <li class=toctree-l1><a href=../../playbooks/manage_jenkins_workers/ class="reference internal">manage_jenkins_workers</a> </li> <li class=toctree-l1><a href=../../playbooks/manage_linux_workstations/ class="reference internal">manage_linux_workstations</a> </li> <li class=toctree-l1><a href=../../playbooks/manage_linux_servers/ class="reference internal">manage_linux_servers</a> </li> <li class=toctree-l1><a href=../../playbooks/manage_office_nodes/ class="reference internal">manage_office_nodes</a> </li> <li class=toctree-l1><a href=../../playbooks/manage_test_nodes/ class="reference internal">manage_test_nodes</a> </li> </ul> <p class=caption><span class=caption-text>Collections</span></p> <ul> <li class=toctree-l1><a href=../../collections/application/ class="reference internal">application</a> </li> <li class=toctree-l1><a href=../../collections/automation/ class="reference internal">automation</a> </li> <li class=toctree-l1><a href=../../collections/backup/ class="reference internal">backup</a> </li> <li class=toctree-l1><a href=../../collections/cloud/ class="reference internal">cloud</a> </li> <li class=toctree-l1><a href=../../collections/container/ class="reference internal">container</a> </li> <li class=toctree-l1><a href=../../collections/database/ class="reference internal">database</a> </li> <li class=toctree-l1><a href=../../collections/development/ class="reference internal">development</a> </li> <li class=toctree-l1><a href=../../collections/devops/ class="reference internal">devops</a> </li> <li class=toctree-l1><a href=../../collections/hardware/ class="reference internal">hardware</a> </li> <li class=toctree-l1><a href=../../collections/hypervisor/ class="reference internal">hypervisor</a> </li> <li class=toctree-l1><a href=../../collections/infrastructure/ class="reference internal">infrastructure</a> </li> <li class=toctree-l1><a href=../../collections/monitor/ class="reference internal">monitor</a> </li> <li class=toctree-l1><a href=../../collections/network/ class="reference internal">network</a> </li> <li class=toctree-l1><a href=../../collections/security/ class="reference internal">security</a> </li> <li class=toctree-l1><a href=../../collections/storage/ class="reference internal">storage</a> </li> <li class=toctree-l1><a href=../../collections/system/ class="reference internal">system</a> </li> <li class=toctree-l1><a href=../../collections/web/ class="reference internal">web</a> </li> </ul> <p class=caption><span class=caption-text>Roles</span></p> <ul class=current> <li class=toctree-l1><a href=../app_blender/ class="reference internal">app_blender</a> </li> <li class=toctree-l1><a href=../app_chrome/ class="reference internal">app_chrome</a> </li> <li class=toctree-l1><a href=../app_darktable/ class="reference internal">app_darktable</a> </li> <li class=toctree-l1><a href=../app_drawio/ class="reference internal">app_drawio</a> </li> <li class=toctree-l1><a href=../app_firefox/ class="reference internal">app_firefox</a> </li> <li class=toctree-l1><a href=../app_freecad/ class="reference internal">app_freecad</a> </li> <li class=toctree-l1><a href=../app_gimp/ class="reference internal">app_gimp</a> </li> <li class=toctree-l1><a href=../app_inkscape/ class="reference internal">app_inkscape</a> </li> <li class=toctree-l1><a href=../app_keepassxc/ class="reference internal">app_keepassxc</a> </li> <li class=toctree-l1><a href=../app_kryta/ class="reference internal">app_kryta</a> </li> <li class=toctree-l1><a href=../app_libreoffice/ class="reference internal">app_libreoffice</a> </li> <li class=toctree-l1><a href=../app_msteams/ class="reference internal">app_msteams</a> </li> <li class=toctree-l1><a href=../app_obs/ class="reference internal">app_obs</a> </li> <li class=toctree-l1><a href=../app_pinta/ class="reference internal">app_pinta</a> </li> <li class=toctree-l1><a href=../app_pitivi/ class="reference internal">app_pitivi</a> </li> <li class=toctree-l1><a href=../app_shotcut/ class="reference internal">app_shotcut</a> </li> <li class=toctree-l1><a href=../app_skype/ class="reference internal">app_skype</a> </li> <li class=toctree-l1><a href=../app_slack/ class="reference internal">app_slack</a> </li> <li class=toctree-l1><a href=../app_spotify/ class="reference internal">app_spotify</a> </li> <li class=toctree-l1><a href=../app_tilix/ class="reference internal">app_tilix</a> </li> <li class=toctree-l1><a href=../app_vscode/ class="reference internal">app_vscode</a> </li> <li class=toctree-l1><a href=../app_xmind/ class="reference internal">app_xmind</a> </li> <li class=toctree-l1><a href=../app_zoom/ class="reference internal">app_zoom</a> </li> <li class="toctree-l1 current"><a href=./ class="reference internal current">auto_ansible_control</a> <ul class=current> <li class=toctree-l2><a class="reference internal" href=#purpose>Purpose</a> </li> <li class=toctree-l2><a class="reference internal" href=#directory-structure>Directory structure</a> </li> <li class=toctree-l2><a class="reference internal" href=#usage>Usage</a> </li> <li class=toctree-l2><a class="reference internal" href=#role-parameters>Role Parameters</a> <ul> <li class=toctree-l3><a class="reference internal" href=#actions>Actions</a> </li> <li class=toctree-l3><a class="reference internal" href=#end-state>End State</a> </li> </ul> </li> <li class=toctree-l2><a class="reference internal" href=#deployment>Deployment</a> <ul> <li class=toctree-l3><a class="reference internal" href=#os-compatibility>OS Compatibility</a> </li> <li class=toctree-l3><a class="reference internal" href=#dependencies>Dependencies</a> </li> <li class=toctree-l3><a class="reference internal" href=#prerequisites>Prerequisites</a> </li> <li class=toctree-l3><a class="reference internal" href=#installation-procedure>Installation Procedure</a> </li> </ul> </li> <li class=toctree-l2><a class="reference internal" href=#contributing>Contributing</a> </li> <li class=toctree-l2><a class="reference internal" href=#author>Author</a> </li> <li class=toctree-l2><a class="reference internal" href=#license>License</a> </li> </ul> </li> <li class=toctree-l1><a href=../auto_ansible_node/ class="reference internal">auto_ansible_node</a> </li> <li class=toctree-l1><a href=../auto_aplatform64/ class="reference internal">auto_aplatform64</a> </li> <li class=toctree-l1><a href=../bkp_archive/ class="reference internal">bkp_archive</a> </li> <li class=toctree-l1><a href=../bkp_rclone_server/ class="reference internal">bkp_rclone_server</a> </li> <li class=toctree-l1><a href=../bkp_restic/ class="reference internal">bkp_restic</a> </li> <li class=toctree-l1><a href=../cnt_docker/ class="reference internal">cnt_docker</a> </li> <li class=toctree-l1><a href=../cnt_kubectl/ class="reference internal">cnt_kubectl</a> </li> <li class=toctree-l1><a href=../cnt_podman/ class="reference internal">cnt_podman</a> </li> <li class=toctree-l1><a href=../cloud_aws_cli/ class="reference internal">cloud_aws_cli</a> </li> <li class=toctree-l1><a href=../cloud_aws_realm/ class="reference internal">cloud_aws_realm</a> </li> <li class=toctree-l1><a href=../cloud_azure_cli/ class="reference internal">cloud_azure_cli</a> </li> <li class=toctree-l1><a href=../cloud_foundry_cli/ class="reference internal">cloud_foundry_cli</a> </li> <li class=toctree-l1><a href=../cloud_google_cli/ class="reference internal">cloud_google_cli</a> </li> <li class=toctree-l1><a href=../cloud_ibm_cli/ class="reference internal">cloud_ibm_cli</a> </li> <li class=toctree-l1><a href=../db_mariadb_client/ class="reference internal">db_mariadb_client</a> </li> <li class=toctree-l1><a href=../db_mariadb_server/ class="reference internal">db_mariadb_server</a> </li> <li class=toctree-l1><a href=../db_mysql_client/ class="reference internal">db_mysql_client</a> </li> <li class=toctree-l1><a href=../db_mysql_server/ class="reference internal">db_mysql_server</a> </li> <li class=toctree-l1><a href=../db_postgresql_client/ class="reference internal">db_postgresql_client</a> </li> <li class=toctree-l1><a href=../db_postgresql_server/ class="reference internal">db_postgresql_server</a> </li> <li class=toctree-l1><a href=../dev_gcc/ class="reference internal">dev_gcc</a> </li> <li class=toctree-l1><a href=../dev_java/ class="reference internal">dev_java</a> </li> <li class=toctree-l1><a href=../dev_nodejs/ class="reference internal">dev_nodejs</a> </li> <li class=toctree-l1><a href=../dev_opencl/ class="reference internal">dev_opencl</a> </li> <li class=toctree-l1><a href=../dev_python/ class="reference internal">dev_python</a> </li> <li class=toctree-l1><a href=../dev_ruby/ class="reference internal">dev_ruby</a> </li> <li class=toctree-l1><a href=../dev_tools/ class="reference internal">dev_tools</a> </li> <li class=toctree-l1><a href=../dops_ansiblelint/ class="reference internal">dops_ansiblelint</a> </li> <li class=toctree-l1><a href=../dops_batscore/ class="reference internal">dops_batscore</a> </li> <li class=toctree-l1><a href=../dops_git_client/ class="reference internal">dops_git_client</a> </li> <li class=toctree-l1><a href=../dops_git_server/ class="reference internal">dops_git_server</a> </li> <li class=toctree-l1><a href=../dops_github_cli/ class="reference internal">dops_github_cli</a> </li> <li class=toctree-l1><a href=../dops_gitlab_server/ class="reference internal">dops_gitlab_server</a> </li> <li class=toctree-l1><a href=../dops_jenkins/ class="reference internal">dops_jenkins</a> </li> <li class=toctree-l1><a href=../dops_molecule/ class="reference internal">dops_molecule</a> </li> <li class=toctree-l1><a href=../dops_shellcheck/ class="reference internal">dops_shellcheck</a> </li> <li class=toctree-l1><a href=../dops_tfsec/ class="reference internal">dops_tfsec</a> </li> <li class=toctree-l1><a href=../dops_yamllint/ class="reference internal">dops_yamllint</a> </li> <li class=toctree-l1><a href=../hpv_libvirt_client/ class="reference internal">hpv_libvirt_client</a> </li> <li class=toctree-l1><a href=../hpv_libvirt_server/ class="reference internal">hpv_libvirt_server</a> </li> <li class=toctree-l1><a href=../hw_gpu_amd/ class="reference internal">hw_gpu_amd</a> </li> <li class=toctree-l1><a href=../infra_helm/ class="reference internal">infra_helm</a> </li> <li class=toctree-l1><a href=../infra_terraform/ class="reference internal">infra_terraform</a> </li> <li class=toctree-l1><a href=../infra_terragrunt/ class="reference internal">infra_terragrunt</a> </li> <li class=toctree-l1><a href=../infra_vagrant/ class="reference internal">infra_vagrant</a> </li> <li class=toctree-l1><a href=../mon_fluentd/ class="reference internal">mon_fluentd</a> </li> <li class=toctree-l1><a href=../net_bind/ class="reference internal">net_bind</a> </li> <li class=toctree-l1><a href=../net_istioctl/ class="reference internal">net_istioctl</a> </li> <li class=toctree-l1><a href=../sec_firewall_os/ class="reference internal">sec_firewall_os</a> </li> <li class=toctree-l1><a href=../sec_firewall_os/ class="reference internal">sec_firewall_os</a> </li> <li class=toctree-l1><a href=../sec_key_ssh/ class="reference internal">sec_key_ssh</a> </li> <li class=toctree-l1><a href=../sec_openssh_client/ class="reference internal">sec_openssh_client</a> </li> <li class=toctree-l1><a href=../sec_openssh_server/ class="reference internal">sec_openssh_server</a> </li> <li class=toctree-l1><a href=../stg_autofs/ class="reference internal">stg_autofs</a> </li> <li class=toctree-l1><a href=../stg_nfs_client/ class="reference internal">stg_nfs_client</a> </li> <li class=toctree-l1><a href=../stg_nfs_server/ class="reference internal">stg_nfs_server</a> </li> <li class=toctree-l1><a href=../stg_repository/ class="reference internal">stg_repository</a> </li> <li class=toctree-l1><a href=../sys_dconf/ class="reference internal">sys_dconf</a> </li> <li class=toctree-l1><a href=../sys_fonts/ class="reference internal">sys_fonts</a> </li> <li class=toctree-l1><a href=../sys_gui_cinnamon/ class="reference internal">sys_gui_cinnamon</a> </li> <li class=toctree-l1><a href=../sys_kernel/ class="reference internal">sys_kernel</a> </li> <li class=toctree-l1><a href=../sys_mc/ class="reference internal">sys_mc</a> </li> <li class=toctree-l1><a href=../sys_package/ class="reference internal">sys_package</a> </li> <li class=toctree-l1><a href=../sys_repository/ class="reference internal">sys_repository</a> </li> <li class=toctree-l1><a href=../sys_shell/ class="reference internal">sys_shell</a> </li> <li class=toctree-l1><a href=../sys_subsystem/ class="reference internal">sys_subsystem</a> </li> <li class=toctree-l1><a href=../sys_sudo/ class="reference internal">sys_sudo</a> </li> <li class=toctree-l1><a href=../sys_tools/ class="reference internal">sys_tools</a> </li> <li class=toctree-l1><a href=../sys_user/ class="reference internal">sys_user</a> </li> <li class=toctree-l1><a href=../web_haproxy/ class="reference internal">web_haproxy</a> </li> <li class=toctree-l1><a href=../web_httpd/ class="reference internal">web_httpd</a> </li> <li class=toctree-l1><a href=../web_mkdocs/ class="reference internal">web_mkdocs</a> </li> <li class=toctree-l1><a href=../web_nginx/ class="reference internal">web_nginx</a> </li> </ul> </div> </div> </nav> <section data-toggle=wy-nav-shift class=wy-nav-content-wrap> <nav class=wy-nav-top role=navigation aria-label="top navigation"> <i data-toggle=wy-nav-top class="fa fa-bars"></i> <a href=../..>A:Platform64 Project</a> </nav> <div class=wy-nav-content> <div class=rst-content> <div role=navigation aria-label="breadcrumbs navigation"> <ul class=wy-breadcrumbs> <li><a href=../..>Docs</a> &raquo;</li> <li>Roles &raquo;</li> <li>auto_ansible_control</li> <li class=wy-breadcrumbs-aside> <a href=https://github.com/serdigital64/aplatform64/edit/master/docs/roles/auto_ansible_control.md class="icon icon-github"> Edit on GitHub</a> </li> </ul> <hr> </div> <div role=main> <div class=section> <h2 id=ansible-role-serdigital64automationauto_ansible_control>Ansible Role: serdigital64.automation.auto_ansible_control<a class=headerlink href=#ansible-role-serdigital64automationauto_ansible_control title="Permanent link">&para;</a></h2> <h3 id=purpose>Purpose<a class=headerlink href=#purpose title="Permanent link">&para;</a></h3> <p>Automate the management of Ansible Control Node.</p> <p>Supported features in the current version:</p> <ul> <li>Create directory structure.</li> <li>Setup site configuration files:<ul> <li>ansible.cfg: regular operation</li> <li>ansible-debug.cfg: task debugging</li> </ul> </li> <li>Create OpenSSH Public/Private key pair for Ansible Managed Nodes</li> <li>Register Ansible Managed Nodes`s OpenSSH server keys in known_hosts file.</li> <li>Create shell environment script for setting Ansible variables.</li> </ul> <p>The <strong>auto_ansible_control</strong> Ansible-Role is part of the <a href=https://github.com/serdigital64/aplatform64>A:Platform64</a> project and is available in the <a href=https://aplatform64.readthedocs.io/en/latest/collections/automation>application</a> Ansible-Collection.</p> <h3 id=directory-structure>Directory structure<a class=headerlink href=#directory-structure title="Permanent link">&para;</a></h3> <p>The directory structure is based on the collection structure recommended by Ansible documentation and extended to hold all the assets that the Ansible Control node will require to manage the target environment.</p> <p>Content is separated into two main groups:</p> <ul> <li>root: infrastructure-as-code content that can be added to a GIT repository. Path is defined in the <code>auto_ansible_control_paths.root</code> variable.</li> <li>var: temporary files, not to be added to GIT. Path is defined in the <code>auto_ansible_control_paths.var</code> variable.</li> </ul> <p>Additional directories are create to further organize content. The full list is defined in <code>auto_ansible_control_base</code> variable.</p> <table> <thead> <tr> <th>Path</th> <th>Content</th> <th>Ansible Variable</th> </tr> </thead> <tbody> <tr> <td><code>root/etc/cfg</code></td> <td>Ansible configuration files</td> <td>ANSIBLE_CONFIG</td> </tr> <tr> <td><code>root/etc/keys</code></td> <td>OpenSSH key pairs</td> <td>ANSIBLE_PRIVATE_KEY_FILE</td> </tr> <tr> <td><code>root/etc/tokens</code></td> <td>API tokens</td> <td>ANSIBLE_GALAXY_TOKEN_PATH</td> </tr> <tr> <td><code>root/bin/</code></td> <td>Shell scripts</td> <td></td> </tr> <tr> <td><code>root/inventories/</code></td> <td>Ansible inventory files, host_vars and group_vars</td> <td>ANSIBLE_INVENTORY</td> </tr> <tr> <td><code>root/playbooks/</code></td> <td>Ansible Playbooks</td> <td>ANSIBLE_PLAYBOOK_DIR</td> </tr> <tr> <td><code>root/collections/</code></td> <td>Collections installed from Ansible-Galaxy</td> <td>ANSIBLE_COLLECTIONS_PATHS</td> </tr> <tr> <td><code>root/roles/</code></td> <td>Custom site-specific Ansible Roles</td> <td>ANSIBLE_ROLES_PATH</td> </tr> <tr> <td><code>root/files/</code></td> <td>Custom site-specific data files</td> <td></td> </tr> <tr> <td><code>root/templates/</code></td> <td>Custom site-specific Ansible Templates</td> <td></td> </tr> <tr> <td><code>root/vars/</code></td> <td>Custom site-specific Ansible variables</td> <td></td> </tr> <tr> <td><code>root/tests/</code></td> <td>Ansible playbooks for testing Custom Ansible Roles and Playbooks</td> <td></td> </tr> <tr> <td><code>root/docs/</code></td> <td>Repository for storing site-specific documentation</td> <td></td> </tr> <tr> <td><code>var/cache</code></td> <td>General purpose cache</td> <td>ANSIBLE_CACHE_PLUGIN_CONNECTION, ANSIBLE_GALAXY_CACHE_DIR</td> </tr> <tr> <td><code>var/logs</code></td> <td>General purpose log store</td> <td>ANSIBLE_LOG_PATH</td> </tr> <tr> <td><code>var/persistence</code></td> <td>General purpose persistence store</td> <td>ANSIBLE_PERSISTENT_CONTROL_PATH_DIR,ANSIBLE_SSH_CONTROL_PATH_DIR</td> </tr> <tr> <td><code>var/tmp</code></td> <td>General purpose ephemeral store</td> <td>ANSIBLE_RETRY_FILES_SAVE_PATH</td> </tr> </tbody> </table> <p>The directory structure incorporates the concept of sites:</p> <ul> <li>Sites are used to isolate group of hosts from each other. For example, create separate sites for production, development, testing environments.</li> <li>Each content directory will have additional subdirectories to hold each site. For example:<ul> <li>etc/cfg/prod</li> <li>etc/cfg/dev</li> <li>etc/cfg/qa</li> </ul> </li> <li>Sites can be activated by using the corresponding environment load script. For example, to set the environment for the <code>prod</code> site: <code>source ansible_control-prod.sh</code></li> </ul> <h3 id=usage>Usage<a class=headerlink href=#usage title="Permanent link">&para;</a></h3> <p>The following example is an <strong>Ansible Playbook</strong> that includes all the supported features:</p> <p><a href=https://github.com/aplatform64/automation/blob/main/playbooks/auto_ansible_control.yml>use this link if viewing the doc on github</a></p> <div class=codehilite><pre><span></span><code><span class=nn>---</span><span class=w></span>
<span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s>&quot;Automation</span><span class=nv> </span><span class=s>/</span><span class=nv> </span><span class=s>Ansible</span><span class=nv> </span><span class=s>/</span><span class=nv> </span><span class=s>Control</span><span class=nv> </span><span class=s>/</span><span class=nv> </span><span class=s>Usage</span><span class=nv> </span><span class=s>example&quot;</span><span class=w></span>
<span class=w>  </span><span class=nt>hosts</span><span class=p>:</span><span class=w> </span><span class=s>&quot;localhost&quot;</span><span class=w></span>
<span class=w>  </span><span class=nt>gather_facts</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class=w></span>
<span class=w>  </span><span class=nt>vars</span><span class=p>:</span><span class=w></span>
<span class=w>    </span><span class=nt>test_user</span><span class=p>:</span><span class=w> </span><span class=s>&quot;{{</span><span class=nv> </span><span class=s>lookup(&#39;env&#39;,&#39;USER&#39;)</span><span class=nv> </span><span class=s>}}&quot;</span><span class=w></span>
<span class=w>    </span><span class=nt>test_group</span><span class=p>:</span><span class=w> </span><span class=s>&quot;{{</span><span class=nv> </span><span class=s>test_user</span><span class=nv> </span><span class=s>}}&quot;</span><span class=w></span>
<span class=w>    </span><span class=nt>test_home</span><span class=p>:</span><span class=w> </span><span class=s>&quot;/home/{{</span><span class=nv> </span><span class=s>test_user</span><span class=nv> </span><span class=s>}}&quot;</span><span class=w></span>
<span class=w>    </span><span class=nt>test_control</span><span class=p>:</span><span class=w> </span><span class=s>&quot;{{</span><span class=nv> </span><span class=s>test_home</span><span class=nv> </span><span class=s>}}/test_ansible64&quot;</span><span class=w></span>

<span class=w>  </span><span class=nt>tasks</span><span class=p>:</span><span class=w></span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s>&quot;Example:</span><span class=nv> </span><span class=s>Create</span><span class=nv> </span><span class=s>the</span><span class=nv> </span><span class=s>directory</span><span class=nv> </span><span class=s>structure</span><span class=nv> </span><span class=s>for</span><span class=nv> </span><span class=s>Ansible</span><span class=nv> </span><span class=s>and</span><span class=nv> </span><span class=s>create</span><span class=nv> </span><span class=s>the</span><span class=nv> </span><span class=s>site</span><span class=nv> </span><span class=s>test&quot;</span><span class=w></span>
<span class=w>      </span><span class=nt>vars</span><span class=p>:</span><span class=w></span>
<span class=w>        </span><span class=nt>auto_ansible_control</span><span class=p>:</span><span class=w></span>
<span class=w>          </span><span class=nt>prepare</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class=w></span>
<span class=w>          </span><span class=nt>setup</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class=w></span>
<span class=w>        </span><span class=nt>auto_ansible_control_users</span><span class=p>:</span><span class=w></span>
<span class=w>          </span><span class=nt>control</span><span class=p>:</span><span class=w></span>
<span class=w>            </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s>&quot;{{</span><span class=nv> </span><span class=s>test_user</span><span class=nv> </span><span class=s>}}&quot;</span><span class=w></span>
<span class=w>            </span><span class=nt>group</span><span class=p>:</span><span class=w> </span><span class=s>&quot;{{</span><span class=nv> </span><span class=s>test_group</span><span class=nv> </span><span class=s>}}&quot;</span><span class=w></span>
<span class=w>            </span><span class=nt>home</span><span class=p>:</span><span class=w> </span><span class=s>&quot;{{</span><span class=nv> </span><span class=s>test_home</span><span class=nv> </span><span class=s>}}&quot;</span><span class=w></span>
<span class=w>        </span><span class=nt>auto_ansible_control_paths</span><span class=p>:</span><span class=w></span>
<span class=w>          </span><span class=nt>root</span><span class=p>:</span><span class=w> </span><span class=s>&quot;{{</span><span class=nv> </span><span class=s>test_control</span><span class=nv> </span><span class=s>}}&quot;</span><span class=w></span>
<span class=w>          </span><span class=nt>var</span><span class=p>:</span><span class=w> </span><span class=s>&quot;{{</span><span class=nv> </span><span class=s>test_control</span><span class=nv> </span><span class=s>}}&quot;</span><span class=w></span>
<span class=w>        </span><span class=nt>auto_ansible_control_site</span><span class=p>:</span><span class=w> </span><span class=s>&quot;test&quot;</span><span class=w></span>
<span class=w>      </span><span class=nt>ansible.builtin.include_role</span><span class=p>:</span><span class=w></span>
<span class=w>        </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s>&quot;serdigital64.automation.auto_ansible_control&quot;</span><span class=w></span>
<span class=nn>...</span><span class=w></span>
</code></pre></div> <p>The playbook can be run by executing:</p> <div class=codehilite><pre><span></span><code><span class=c1># Set ANSIBLE_COLLECTIONS_PATHS to the default location. Change as needed.</span>
<span class=nv>ANSIBLE_COLLECTIONS_PATHS</span><span class=o>=</span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>HOME</span><span class=si>}</span><span class=s2>/.ansible/collections&quot;</span>
ansible-playbook <span class=s2>&quot;</span><span class=si>${</span><span class=nv>ANSIBLE_COLLECTIONS_PATHS</span><span class=si>}</span><span class=s2>/ansible_collections/serdigital64/automation/playbooks/auto_ansible_control.yml&quot;</span>
</code></pre></div> <h3 id=role-parameters>Role Parameters<a class=headerlink href=#role-parameters title="Permanent link">&para;</a></h3> <h4 id=actions>Actions<a class=headerlink href=#actions title="Permanent link">&para;</a></h4> <ul> <li>Use <strong>action-parameters</strong> to control what tasks are enabled for the role to execute.</li> <li>Parameters should be declared as task level vars as they are intented to be dynamic.</li> </ul> <div class=codehilite><pre><span></span><code><span class=nt>auto_ansible_control</span><span class=p>:</span><span class=w></span>
<span class=w>  </span><span class=nt>resolve_prereq</span><span class=p>:</span><span class=w></span>
<span class=w>  </span><span class=nt>prepare</span><span class=p>:</span><span class=w></span>
<span class=w>  </span><span class=nt>setup</span><span class=p>:</span><span class=w></span>
<span class=w>  </span><span class=nt>provision</span><span class=p>:</span><span class=w></span>
</code></pre></div> <table> <thead> <tr> <th>Parameter</th> <th>Required?</th> <th>Type</th> <th>Default</th> <th>Purpose / Value</th> </tr> </thead> <tbody> <tr> <td>auto_ansible_control.resolve_prereq</td> <td>no</td> <td>boolean</td> <td><code>false</code></td> <td>Enable automatic resolution of prequisites</td> </tr> <tr> <td>auto_ansible_control.prepare</td> <td>no</td> <td>boolean</td> <td><code>false</code></td> <td>Enable preparation of the runtime environment</td> </tr> <tr> <td>auto_ansible_control.setup</td> <td>no</td> <td>boolean</td> <td><code>false</code></td> <td>Enable configuration of the runtime environment</td> </tr> <tr> <td>auto_ansible_control.provision</td> <td>no</td> <td>boolean</td> <td><code>false</code></td> <td>Enable processing of SSH keys</td> </tr> </tbody> </table> <h4 id=end-state>End State<a class=headerlink href=#end-state title="Permanent link">&para;</a></h4> <ul> <li>Use <strong>end-state</strong> parameters to define the target state after role execution.</li> <li>Parameters should be declared in <strong>host_vars</strong> or <strong>group_vars</strong> as they are intended to be permanent.</li> </ul> <div class=codehilite><pre><span></span><code><span class=nt>auto_ansible_control_site</span><span class=p>:</span><span class=w></span>
<span class=nt>auto_ansible_control_node</span><span class=p>:</span><span class=w></span>
<span class=nt>auto_ansible_control_python</span><span class=p>:</span><span class=w></span>
<span class=nt>auto_ansible_control_users</span><span class=p>:</span><span class=w></span>
<span class=w>  </span><span class=nt>control</span><span class=p>:</span><span class=w></span>
<span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w></span>
<span class=w>    </span><span class=nt>group</span><span class=p>:</span><span class=w></span>
<span class=w>    </span><span class=nt>home</span><span class=p>:</span><span class=w></span>
<span class=nt>auto_ansible_control_paths</span><span class=p>:</span><span class=w></span>
<span class=w>  </span><span class=nt>root</span><span class=p>:</span><span class=w></span>
<span class=w>  </span><span class=nt>var</span><span class=p>:</span><span class=w></span>
<span class=nt>auto_ansible_control_key</span><span class=p>:</span><span class=w></span>
<span class=w>  </span><span class=nt>type</span><span class=p>:</span><span class=w></span>
<span class=w>  </span><span class=nt>size</span><span class=p>:</span><span class=w></span>
<span class=nt>auto_ansible_control_managed</span><span class=p>:</span><span class=w></span>
</code></pre></div> <table> <thead> <tr> <th>Parameter</th> <th>Required?</th> <th>Type</th> <th>Default</th> <th>Purpose / Value</th> </tr> </thead> <tbody> <tr> <td>auto_ansible_control_site</td> <td>no</td> <td>string</td> <td><code>"site"</code></td> <td>Short name of the site that will be managed by A:Platform64</td> </tr> <tr> <td>auto_ansible_control_node</td> <td>no</td> <td>string</td> <td><code>"localhost"</code></td> <td>Ansible Control Node`s hostname. The hostname must resolve to a valid IP address</td> </tr> <tr> <td>auto_ansible_control_python</td> <td>no</td> <td>string</td> <td><code>"/usr/bin/python3.9"</code></td> <td>Set the path to the Python 3.9 interpreter</td> </tr> <tr> <td>auto_ansible_control_users</td> <td>yes</td> <td>dictionary</td> <td></td> <td>Define what users will use the automation platform</td> </tr> <tr> <td>auto_ansible_control_users.control</td> <td>yes</td> <td>dictionary</td> <td></td> <td>Define the user that will own and run tasks on the Ansible Control Node</td> </tr> <tr> <td>auto_ansible_control_users.control.name</td> <td>yes</td> <td>string</td> <td><code>"sitectl"</code></td> <td>User's login name</td> </tr> <tr> <td>auto_ansible_control_users.control.group</td> <td>yes</td> <td>string</td> <td><code>"sitectl"</code></td> <td>User's primary group name</td> </tr> <tr> <td>auto_ansible_control_users.control.home</td> <td>yes</td> <td>string</td> <td><code>"/home/sitectl"</code></td> <td>User's home directory</td> </tr> <tr> <td>auto_ansible_control_paths</td> <td>yes</td> <td>dictionary</td> <td></td> <td>Define where will A:Platform64 be installed to</td> </tr> <tr> <td>auto_ansible_control_paths.root</td> <td>yes</td> <td>string</td> <td><code>"/opt/sitectl"</code></td> <td>Base directory for collections, roles, configuration</td> </tr> <tr> <td>auto_ansible_control_paths.var</td> <td>yes</td> <td>string</td> <td><code>"/var/opt/sitectl"</code></td> <td>Base directory for logs, cache, temporary content</td> </tr> <tr> <td>auto_ansible_control_key</td> <td>no</td> <td>dictionary</td> <td></td> <td>Define OpenSSH key parameters</td> </tr> <tr> <td>auto_ansible_control_key.type</td> <td>no</td> <td>string</td> <td><code>"ed25519"</code></td> <td>Key type. Valid values: as accepted by ssh-keygen</td> </tr> <tr> <td>auto_ansible_control_key.size</td> <td>no</td> <td>string</td> <td></td> <td>Key size</td> </tr> <tr> <td>auto_ansible_control_managed</td> <td>no</td> <td>list</td> <td></td> <td>List of Ansible Managed Hosts controlled by this Ansible Control node</td> </tr> </tbody> </table> <h3 id=deployment>Deployment<a class=headerlink href=#deployment title="Permanent link">&para;</a></h3> <h4 id=os-compatibility>OS Compatibility<a class=headerlink href=#os-compatibility title="Permanent link">&para;</a></h4> <p>The operating system compatibility list is defined in the variable: <code>auto_ansible_control_platforms</code></p> <h4 id=dependencies>Dependencies<a class=headerlink href=#dependencies title="Permanent link">&para;</a></h4> <ul> <li>Ansible Collections:<ul> <li>serdigital64.backup<ul> <li>bkp_archive</li> </ul> </li> <li>serdigital64.system<ul> <li>sys_package</li> <li>sys_repository</li> </ul> </li> <li>serdigital64.security<ul> <li>sec_openssh_client</li> <li>sec_key_ssh</li> </ul> </li> </ul> </li> </ul> <h4 id=prerequisites>Prerequisites<a class=headerlink href=#prerequisites title="Permanent link">&para;</a></h4> <p>The Ansible engine must be already installed and configured for privileged access and remote execution.</p> <h4 id=installation-procedure>Installation Procedure<a class=headerlink href=#installation-procedure title="Permanent link">&para;</a></h4> <p>Manually install Ansible Collections from the Ansible Galaxy repository:</p> <div class=codehilite><pre><span></span><code>ansible-galaxy collection install --upgrade serdigital64.automation
</code></pre></div> <p>Automatic installation is also available by deploying <a href=https://aplatform64.readthedocs.io/en/latest/#deployment>A:Platform64</a></p> <h3 id=contributing>Contributing<a class=headerlink href=#contributing title="Permanent link">&para;</a></h3> <p>Help on implementing new features and maintaining the code base is welcomed.</p> <p>Please see the <a href=https://aplatform64.readthedocs.io/en/latest/contributing/CONTRIBUTING>guidelines</a> for further details.</p> <h3 id=author>Author<a class=headerlink href=#author title="Permanent link">&para;</a></h3> <ul> <li><a href=https://serdigital64.github.io/ >SerDigital64</a></li> </ul> <h3 id=license>License<a class=headerlink href=#license title="Permanent link">&para;</a></h3> <p><a href=https://www.gnu.org/licenses/gpl-3.0.txt>GPL-3.0-or-later</a></p> </div> </div> <footer> <div class=rst-footer-buttons role=navigation aria-label="footer navigation"> <a href=../auto_ansible_node/ class="btn btn-neutral float-right" title=auto_ansible_node>Next <span class="icon icon-circle-arrow-right"></span></a> <a href=../app_zoom/ class="btn btn-neutral" title=app_zoom><span class="icon icon-circle-arrow-left"></span> Previous</a> </div> <hr> <div role=contentinfo> <p>GPL-3.0-or-later</p> </div> Built with <a href=https://www.mkdocs.org/ >MkDocs</a> using a <a href=https://github.com/snide/sphinx_rtd_theme>theme</a> provided by <a href=https://readthedocs.org>Read the Docs</a>. </footer> </div> </div> </section> </div> <div class=rst-versions role=note aria-label=versions> <span class=rst-current-version data-toggle=rst-current-version> <span> <a href=https://github.com/serdigital64/aplatform64/ class="fa fa-github" style="color: #fcfcfc"> GitHub</a> </span> <span><a href=../app_zoom/ style="color: #fcfcfc">&laquo; Previous</a></span> <span><a href=../auto_ansible_node/ style="color: #fcfcfc">Next &raquo;</a></span> </span> </div> <script>var base_url = '../..';</script> <script src=../../js/theme_extra.js defer></script> <script src=../../js/theme.js defer></script> <script src=../../search/main.js defer></script> <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script> </body> </html> 